cmake_minimum_required(VERSION 3.8)

# 项目信息
project(GateServer LANGUAGES CXX)
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -v")
set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,--trace-symbol=_missing_symbol")
# 设置 C++ 标准
set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 手动设置库路径
set(BOOST_ROOT "D:/cppsoft/boost_1_84")
set(JSONCPP_DIR "D:/cppsoft/jsoncpp")
set(BOOST_INCLUDE_DIR "${BOOST_ROOT}/include/boost-1_84")
set(BOOST_LIBRARY_DIR "${BOOST_ROOT}/lib")

# set(CMAKE_LIBRARY_PATH "${CMAKE_LIBRARY_PATH};D:/Qt/Tools/mingw1120_64/x86_64-w64-mingw32/lib")
# 查找 Boost


# 查找 JsonCpp 库
#if (NOT EXISTS "${JSONCPP_DIR}/include/json/json.h")
#  message(FATAL_ERROR "JsonCpp headers not found in ${JSONCPP_DIR}/include.")
#endif()

# 手动设置 JsonCpp 库路径并查找
find_library(JSONCPP_LIBRARY NAMES jsoncpp_static libjsoncpp_static HINTS "${JSONCPP_DIR}/lib")
find_library(BOOST_SYSTEM_LIBRARIE
        NAMES libboost_system-mgw11-mt-d-x64-1_84.a
        HINTS ${BOOST_LIBRARY_DIR}
)
find_library(BOOST_THREAD_LIBRARIE
        NAMES libboost_thread-mgw11-mt-d-x64-1_84.a
        HINTS ${BOOST_LIBRARY_DIR}
)

file(GLOB ALL_LIBS "D:/Qt/Tools/mingw1120_64/x86_64-w64-mingw32/lib/*.a")

foreach(LIB_PATH ${ALL_LIBS})
    message(STATUS "Found library: ${LIB_PATH}")
    list(APPEND LIBS_TO_LINK ${LIB_PATH})
endforeach()

#if (NOT JSONCPP_LIBRARY)
#  message(FATAL_ERROR "JsonCpp library not found in ${JSONCPP_DIR}/lib.")
#else()
#  message(STATUS "JsonCpp Library: ${JSONCPP_LIBRARY}")
#endif()

# 添加可执行文件
add_executable(GateServer "GateServer.cpp"  "CServer.h" "CServer.cpp"  "const.h" "HttpConnection.h" "HttpConnection.cpp" "Singleton.h" "LogicSystem.h" "LogicSystem.cpp")
# add_executable(GateServer "CmakeProject1.cpp" "CmakeProject1.h")

# 添加头文件路径和库路径
target_include_directories(GateServer PRIVATE ${BOOST_INCLUDE_DIR} ${JSONCPP_DIR}/include)

# 链接库
# target_link_libraries(GateServer PRIVATE ${BOOST_SYSTEM_LIBRARIE} ${BOOST_THREAD_LIBRARIE} ${JSONCPP_LIBRARY} D:\Qt\Tools\mingw1120_64\x86_64-w64-mingw32\lib\libws2_32.a)
# "D:/Qt/Tools/mingw1120_64/x86_64-w64-mingw32/lib/libws2_32.a"
target_link_libraries(GateServer PRIVATE
        ${BOOST_SYSTEM_LIBRARIES}
        ${BOOST_THREAD_LIBRARIES}
        ${JSONCPP_LIBRARY}
        "D:/Qt/Tools/mingw1120_64/x86_64-w64-mingw32/lib/libws2_32.a"
        "D:/Qt/Tools/mingw1120_64/x86_64-w64-mingw32/lib/libwsock32.a"
        "D:/Qt/Tools/mingw1120_64/x86_64-w64-mingw32/lib/libmswsock.a"

)


set_target_properties(GateServer PROPERTIES
        INSTALL_RPATH "${JSONCPP_DIR}/lib"
)
